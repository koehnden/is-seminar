#######Funktion forApplying all the filter on the different data sets ########
#
# TODO: add FCBF and maybe another new filter, find a better solution for mRMR 
#
# needs a data frame as an input with the target column named as "target"
applyFS <- function(data, discrete.data=T, colnames=T, cutoff.percent=0.1){
  # get the index of the target variable  
  idx.target <- which(colnames(data)=="target")
  
  # get the number of features
  p <- ncol(data[,-idx.target])
  
  ############ Methods that can handle contiuos inputs
  ## relief
  # note that the relief function in FSelector takes to much time therefore we
  # use the implementation in the CORElearn package
  set.seed(12345)
  # calculate relief variable importance
  # returns a warning message but seems to work properly
  rank.relief <- data.frame(suppressWarnings(attrEval(target~., 
                              data = data, estimator = "Relief")))
  # cutoff the 10% best features
  relief <- cutoff.k.percent(rank.relief,k=cutoff.percent)
  
  ## consistency-based filter
  # consistency() function in the FSelector package also quite slow
  consistency <- consistency(target~., data=data) # output feature names 
  
  ## cfs
  cfs <- cfs(target~., data=data) # output feature names
  
  # library(Biocomb) can somehow not be installed
  #select.fast.filter(as.matrix(data), disc.method,threshold,attrs.nominal)
  
  #################### Methods that need discrete inputs #####################
  # discretize if data contains contious variables
  if(discrete.data==FALSE){
    data <- discretize(data, disc="equalwidth", 
                       nbins=dim(unique(data))[1])
  }#end if
  
  # Information Gain
  rank.InfoGain <- information.gain(target~.,data=data)
  InfoGain <- cutoff.k.percent(rank.InfoGain,k=cutoff.percent)
  
  ## mRMR
  # returns the index of the choosen features
  # X needs to be a matrix
  mRMR.idx <- filter.mRMR(X=as.matrix(data[,-idx.target]), Y=data[,idx.target],
              nbreVarX_=ceiling(p*cutoff.percent))
  mRMR <- colnames(data[,mRMR.idx$filter]) # return the colnames
  ## Does not work properly: Returns also the target sometimes
  
  ## IWFS
  IWFS <- iwfs(target=data[,idx.target], features=data[,-idx.target], 
                K=ceiling(p*cutoff.percent))
  # get the choosen features
  IWFS <- IWFS$selected.features
  
  ## FSFC 
  FCFS <- fsfc(target=data[,idx.target],features=data[,-idx.target], 
                K=ceiling(p*cutoff.percent))
  
  # return a list with all the filter results
  return(list(Relief=relief,Consistency=consistency,CFS=cfs,InfoGain=InfoGain,
              mRMR=mRMR,IWFS=IWFS, FCFS=FCFS))
}#end apply FS 

### apply all filter to the data sets
corral.fs <- applyFS(data=corral_100.tr)
xor.fs <- applyFS(data=xor_100.tr)
monk.fs <- applyFS(data=monk.tr[,-8], cutoff.percent=0.5)
parity.fs <- applyFS(data=parity.tr, cutoff.percent=0.5) 
toy1.fs <- applyFS(data=toy1.tr,discrete.data=F)
toy2.fs <- applyFS(data=toy2.tr,discrete.data=F)
toy3.fs <- applyFS(data=toy3.tr,discrete.data=F)



